# 메시지

---

## 정의

- HTTP 어플리케이션 간 주고 받은 데이터 블록

## 송신 방향

### 인바운드로 송신

- 클라이언트 → 서버 (인바운드로 이동)
- 클라이언트 ← 서버 (아웃바운드로 복귀)

### 다운스트림으로 흐름

- 클라이언트 → 서버 → 클라이언트
- 메시지 발송자는 수신자의 업스트림

## 구성

### 시작줄

- 어떤 메시지인지 서술
- 줄 단위의 아스키 문자열

### 헤더 블록

- 속성
- 줄 단위의 아스키 문자열

### 본문

- 데이터 (없을수도 있음)
- 텍스트나 이진 데이터

## 문법

### 요청 메시지

- 웹 서버에 동작 요구
- 각 필드는 공백으로 구분
  

```
시작줄 : <메서드> <요청 URL> <HTTP 버전>
<헤더>

<엔티티 본문>
```

### 응답 메시지

- 요청의 결과를 클라이언트에 반환
- 각 필드는 공백으로 구분
  

```
시작줄 : <버전> <상태 코드> <사유 구절>
<헤더>

<엔티티 본문>
```

### 메서드

- 서버에게 무엇을 해야하는지 요청하는 것
- 안전한 메서드 (Safe Method)
    - GET이나 HEAD 메서드를 사용하는 요청의 결과로 서버에 어떤 작용도 없는 것
    - 안전한 메서드가 서버에 작동을 유발하지 않는다는 보장은 없음
    - 서버에 어떤 영향을 줄 수 있는 메서드가 사용될 때 사용자들에게 그 사실을 알려주는 HTTP 어플리케이션을 만들 수 있도록 하는 것
- 확장 메서드
    - HTTP/1.1 명세에 정의되지 않는 메서드

| method                                                       | 설명                                             | 본문 여부 | 안전한 메서드 | 확장 메서드 |
| ------------------------------------------------------------ | ------------------------------------------------ | --------- | ------------- | ----------- |
| GET                                                          | 서버에서 문서 조회                               | X         | O             | X           |
| HEAD                                                         | 서버에서 문서의 헤더만 조회                      |           |               |             |
| 엔티티 본문은 반환되지 않음                                  | X                                                | O         | X             |             |
| POST                                                         | 서버에서 처리해야할 데이터 호출                  |           |               |             |
| 서버에 입력 데이터를 전송하기 위해 설계                      | O                                                | X         | X             |             |
| PUT                                                          | 서버에 요청 메시지의 본문 저장                   |           |               |             |
| 서버가 요청 본문을 가지고 새 문서를 만들거나 이미 URL이 존재한다면 본문을 사용해서 교체 | O                                                | X         | X             |             |
| TRACE                                                        | 메시지가 프록시를 거쳐 서버에 도달하는 과정 추적 |           |               |             |
| 루프백 진단                                                  | X                                                | X         | X             |             |
| OPTIONS                                                      | 서버가 메서드를 수행할 수 있는지 확인            | X         | X             | X           |
| DELETE                                                       | 서버에서 문서 제거                               |           |               |             |
| 클라이언트는 삭제가 수행된 것은 보장하지 않음 → HTTP 명세는 클라이언트에게 알리지 않고 요청을 무시하는 것은 허용 | X                                                | X         | X             |             |
| LOCK                                                         | 사용자가 리소스를 잠글 수 있도록 허용            |           |               | O           |
| MKCOL                                                        | 사용자가 문서를 생성하도록 허용                  |           |               | O           |
| COPY                                                         | 서버에 있는 리소스 복사                          |           |               | O           |
| MOVE                                                         | 서버에 있는 리소스 이동                          |           |               | O           |

### 버전 번호

- HTTP 어플리케이션이 자신들이 따르는 프로토콜 버전을 전달하는 수단
- HTTP/x.y 형식
- 하위 버전은 상위 버전의 새로운 기능을 사용할 수 없다.

### 상태코드

- 클라이언트에게 무엇이 일어나는지 회신하는 것
- 응답의 시작줄에 위치하며, 숫자로 된 코드로 구성됨
    - ex) **200** OK

| 전체 범위 | 정의된 범위 | 분류 | 설명 |
| --- | --- | --- | --- |
| 100-199 | 100-101 | 정보 | HTTP 1.1에서 도입정의된 정보에 대한 상태를 제공 |
| 200-299 | 200-206 | 성공 | 클라이언트가 보낸 요청에 대응하는 성공을 의미하는 상태 코드의 배열의 제공 |
| 300-399 | 300-305 | 리다이렉션 | 클라이언트가 관심있어하는 리소스에 대해 다른 위치를 사용하라고 말해주거나 리소스의 내용 대신 다른 대안 응답을 제공 |
| 400-499 | 400-415 | 클라이언트 에러 | 서버가 다룰 수 없는 것과 같은 잘못된 구성에 응답을 제공 |
| 500-599 | 500-505 | 서버 에러 | 서버 자체에서의 에러 제공 |

### 사유 구절

- 응답 시작줄의 마지막 구성 요소
    - 문자로 된 열
        - ex) 200 **OK**

### 헤더

- 요청과 응답메시지에 대한 추가 정보
- key-value 쌍의 목록
    - ex) Content-length: 15040
- 긴 헤더 줄은 여러 줄로 쪼개야 가독성이 좋다.
    - 추가 줄 앞에는 최소 하나의 스페이스 혹은 텝 문자가 와야한다.

| 헤더 분류 | 설명 |
| --- | --- |
| 일반 헤더 | 요청과 응답 양쪽 모두에 나타날 수 있음 |
| 요청 헤더 | 요청에 대한 부가 정보를 제공 |
| 응답 헤더 | 응답에 대한 부가 정보를 제공 |
| 엔티티 헤더 | 본문 크기와 콘텐츠, 혹은 그 리소스 자체를 서술 |
| 확장 헤더 | 명세에 정의되지 않는 세로운 헤더 |

### 일반 헤더

- 일반 헤더는 클라이언트와 서버 양쪽 모두가 사용
- 이들은 클라이언트, 서버, 그리고 어딘가에 메시지를 보내는 다른 애플리케이션들을 위해 다양한 목적으로 사용

| 헤더 | 설명 |
| --- | --- |
| Connection | 클라이언트와 서버가 요청/응답 연결에 대한 옵션을 정할 수 있게 해준다 |
| Date | 메시지가 언제 만들어졌는지에 대한 날짜와 시간을 제공한다 |
| MIME-Version | 발송자가 사용한 MIME 버전을 알려준다 |
| Trailer chunked transfer | 인코딩으로 인코딩된 메시지의 끝 부분에 위치한 헤더들의 목록을 나열한다 |
| Transfer-Encoding | 수신자에게 안전한 전송을 위해 메시지에 어떤 인코딩이 적용되었는지 말해준다 |
| Upgrade | 발송자가 업그레이드 하길 원하는 새 버전이나 프로토콜을 알려준다 |
| Via | 이 메시지가 어떤 중개자(프록시, 게이트웨이)를 거쳐 왔는지 보여준다 |

### **일반 캐시 헤더**

- HTTP/1.0은 HTTP 애플리케이션에게 매번 원 서버로부터 객체를 가져오는 대신 로컬 복사본으로 캐시할 수 있도록 해주는 최초의 헤더를 도
- 최신 버전의 HTTP는 매우 풍부한 캐시 매개변수의 집합을 가지고 있음

| 헤더 | 설명 |
| --- | --- |
| Cache-Control | 메시지와 함께 캐시 지시자를 전달하기 위해 사용한다 |
| Pragma | 메시지와 함께 지시자를 전달하는 또 다른 방법. 캐시에 국한되지 않는다 |

### **요청 헤더**

- 요청 헤더는 요청 메시지에서만 의미
- 요청이 최초 발생한 곳에서 누가 혹은 무엇이 그 요청을 보냈는지에 대한 정보나 클라이언트의 선호나 능력에 대한 정보를 줌

| 헤더 | 설명 |
| --- | --- |
| Client-IP | 클라이언트가 실행된 컴퓨터의 IP를 제공한다 |
| From | 클라이언트 사용자의 메일 주소를 제공한다 |
| Host | 요청의 대상이 되는 서버의 호스트 명과 포트를 준다 |
| Referer | 현재의 요청 URI가 들어있었던 문서의 URL을 제공한다 |
| User-Agent | 요청을 보낸 애플리케이션의 이름을 서버에게 말해준다 |

### **Accept 관련 헤더**

- 클라이언트는 Accept 관련 헤더들을 이용해 서버에게 자신의 선호와 능력을 알려줄 수 있음
- 클라이언트가 원하는 것을 얻을 수 있으며, 서버는 클라이언트가 사용할 수도 없는 것을 전송하는 데 시간과 대역폭을 낭비하지 않을 수 있음